import json
import discord
from discord.ext import commands

intents = discord.Intents.default()
intents.members = True
bot = commands.Bot(command_prefix="!", intents=intents)

# Ù†ÙØ³ Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø§Ù†Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
RANK_ROLES = {
    "UNRANKED": {
        "role_name": "UNRANKED",
        "min_mmr": 0,
        "max_mmr": 799,
        "name": "ã€£ UNRANKED",
        "emoji": "<:0UNRANKED:1395077317407277216>",
        "color": 0x808080
    },
    "SILVER": {
        "role_name": "SILVER SEEKER",
        "min_mmr": 800,
        "max_mmr": 949,
        "name": "ã€£ SILVER SEEKER",
        "emoji": "<:1SILVER:1395077319563149422>",
        "color": 0xC0C0C0
    },
    "PLATINUM": {
        "role_name": "PLATINUM SEEKER",
        "min_mmr": 950,
        "max_mmr": 1099,
        "name": "ã€£ PLATINUM SEEKER",
        "emoji": "<:2PLATINUM:1395077322213822564>",
        "color": 0x00FFFF
    },
    "CRYSTAL": {
        "role_name": "CRYSTAL SEEKER",
        "min_mmr": 1100,
        "max_mmr": 1249,
        "name": "ã€£ CRYSTAL SEEKER",
        "emoji": "<:3CRYSTAL:1395077324382404719>",
        "color": 0x9932CC
    },
    "ELITE": {
        "role_name": "ELITE SEEKER",
        "min_mmr": 1250,
        "max_mmr": 1449,
        "name": "ã€£ ELITE SEEKER",
        "emoji": "<:4ELITE:1395077326416642078>",
        "color": 0xFFD700
    },
    "MASTER": {
        "role_name": "MASTER SEEKER",
        "min_mmr": 1450,
        "max_mmr": 1699,
        "name": "ã€£ MASTER SEEKER",
        "emoji": "<:5Mastermin:1395077330963267776>",
        "color": 0xFF4500
    },
    "LEGENDARY": {
        "role_name": "LEGENDARY SEEKER",
        "min_mmr": 1700,
        "max_mmr": 9999,
        "name": "ã€£ LEGENDARY SEEKER",
        "emoji": "<:6LEGENDARYmin:1395077334003876012>",
        "color": 0xFF0000
    }
}

def get_rank_role(mmr):
    for rank_data in RANK_ROLES.values():
        if rank_data['min_mmr'] <= mmr <= rank_data['max_mmr']:
            return rank_data
    return RANK_ROLES['UNRANKED']

@bot.command()
async def leaderboard(ctx):
    with open("players.json", "r") as f:
        data = json.load(f)

    sorted_data = sorted(data, key=lambda x: x["mmr"], reverse=True)

    embed = discord.Embed(title="ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†", color=0x00ffcc)
    embed.set_thumbnail(url="https://cdn-icons-png.flaticon.com/512/1077/1077012.png")

    for i, player in enumerate(sorted_data[:10]):
        user = await bot.fetch_user(player["id"])
        mmr = player["mmr"]
        wins = player.get("wins", 0)
        losses = player.get("losses", 0)
        total_games = wins + losses
        winrate = (wins / total_games) * 100 if total_games > 0 else 0.0

        rank_data = get_rank_role(mmr)
        emoji = rank_data["emoji"]

        embed.add_field(
            name=f"#{i+1} {emoji} {user.name}",
            value=(
                f"**MMR:** `{mmr}`\n"
                f"**Ø§Ù„Ø±ØªØ¨Ø©:** {rank_data['name']}\n"
                f"**âœ… ÙÙˆØ²:** `{wins}`  |  **âŒ Ø®Ø³Ø§Ø±Ø©:** `{losses}`\n"
                f"**ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù‚ÙŠÙ…:** `{total_games}`  |  **ğŸ… Win Rate:** `{winrate:.1f}%`"
            ),
            inline=False
        )

    await ctx.send(embed=embed)

bot.run("Ø¶Ø¹ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ù‡Ù†Ø§")
